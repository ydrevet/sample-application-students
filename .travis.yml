git:
  depth: 5

jobs:
  include:
    - stage: "Build and Test Java"
      language: "java"
      jdk: "oraclejdk11"
      before_script:
        - "cd sample-application-backend"
      script:
        - "mvn clean verify"
    - stage: "Build and Test Nodejs"
      language: "node_js"
      node_js: "12.20"
      before_install:
        - "cd sample-application-frontend"
      install:
        - "npm install"
      script:
        - "npm run test"
    - stage: "Publish"
      script:
        - "cd sample-application-backend"
        - "docker build -t $DOCKERHUB_LOGIN/simpleapp-back:latest ."
        - "docker login -u $DOCKERHUB_LOGIN -p $DOCKERHUB_PASSWORD"
        - "docker push $DOCKERHUB_LOGIN/simpleapp-back:latest"
    - stage: "Publish"
      script:
        - "cd sample-application-frontend"
        - "docker build -t $DOCKERHUB_LOGIN/simpleapp-front:latest ."
        - "docker login -u $DOCKERHUB_LOGIN -p $DOCKERHUB_PASSWORD"
        - "docker push $DOCKERHUB_LOGIN/simpleapp-front:latest"
cache:
  directories:
    - "$HOME/.m2/repository"
    - "$HOME/.npm"
